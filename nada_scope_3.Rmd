---
title: "nada_scope_3"
author: "Shelby Walsh"
date: "10/27/2020"
output: html_document
---

```{r setup, include=FALSE, message = FALSE, warning = FALSE, echo = FALSE}
rm(list = ls())
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(tidyr)
library(janitor)
library(kableExtra)
#library(car) # this package is apparently my computer's sworn nemesis
library(devtools)
library(broom)
library(ggpubr)
library(ggbeeswarm)
library(RColorBrewer)
library(effsize)
library(stargazer)
```


1. Read in the data
```{r}
all_data <- read_csv("2019_vendor_invoice.csv") %>% 
  clean_names()
```

2. Sort out irrevelant columns and drop NAs for item.
```{r}
all_data <- all_data %>% 
  select(purchase_order, vendor, receipt_id, item, unit, date, cost_unit, total_quantity, total_cost)

all_data <- all_data %>% 
  drop_na(item) # The are the "line items" for each order
# We lost 3836 rows
```

3.Group suppliers by spend, and select the top suppliers:
```{r}
spend_grouping <- all_data  %>% 
  group_by(vendor) %>% 
  summarise(cost = sum(total_cost)) %>% 
  arrange(-cost) %>% 
  head(29)
# #29 is top 80%
# This is not relevant to what we decided to do.
```

4. Group products and calculate total spend.
```{r}
all_products <- all_data  %>% 
  group_by(item) %>% 
  summarise(quantity = sum(total_quantity), 
            cost = sum(total_cost))
```

5. The next step is sorting products into basic categories

(1) So, first product category: Eggs.
```{r}
# Eggs
eggs_category_1 <- all_products %>% 
 filter(grepl('Eggs|eggs', item))

# Subtract those words from all_products
all_products <- all_products[!grepl('Eggs|eggs', all_products$item),]

# Give Eggs the Product Category Code 1
eggs_category_1 <- eggs_category_1 %>%
  add_column(prod_cat = 1)
```


(2) Cheese
```{r}
# Cheese
cheese_category_2 <- all_products %>% 
 filter(grepl('cheese,|Cheese,', item))

# Subtract those words from all_products
all_products <- all_products[!grepl('cheese|Cheese', all_products$item),]

# Give Eggs the Product Category Code 1
cheese_category_2 <- cheese_category_2 %>%
  add_column(prod_cat = 2)
```

(3)
```{r}
grains_product_category <- item_grouping %>% 
 filter(grepl('milk|Milk|Cream|cream', item))
```

%>